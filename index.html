<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBBT: 120 Dní - Seriálová Edice</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Roboto:wght@400;700&display=swap');

        :root {
            --tbbt-red: #cc0000;
            --tbbt-yellow: #ffcc00;
            --tbbt-blue: #0066cc;
            --gold: #ffd700;
        }

        body, html { 
            margin: 0; padding: 0; height: 100%; 
            font-family: 'Roboto', sans-serif; 
            overflow: hidden;
            background-attachment: fixed;
            background-image: 
                radial-gradient(#00000011 1px, transparent 1px),
                linear-gradient(to right, #00000009 1px, transparent 1px),
                linear-gradient(to bottom, #00000009 1px, transparent 1px);
            background-size: 40px 40px, 20px 20px, 20px 20px;
            transition: background-color 1.5s ease;
        }

        #game-container { height: 100%; display: flex; flex-direction: column; position: relative; }

        #main-stage { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 15px; z-index: 5; }

        #question-panel {
            background: rgba(255, 255, 255, 0.96);
            border: 6px solid black;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.2);
            width: 100%; max-width: 650px; padding: 25px; text-align: center; border-radius: 20px;
        }

        #day-story-log {
            margin-top: 15px; padding: 12px; background: #fffde7;
            border-left: 6px solid var(--tbbt-red); text-align: left;
            font-style: italic; font-size: 0.9rem; color: #333;
            max-height: 120px; overflow-y: auto; border-radius: 5px;
        }

        .header-info { display: flex; justify-content: space-between; background: black; color: white; padding: 12px 20px; font-family: 'Bangers'; font-size: 1.2rem; }
        .story-bar { background: var(--tbbt-yellow); color: black; padding: 8px 20px; font-weight: bold; border-bottom: 4px solid black; display: flex; justify-content: space-between; }

        .choices-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 15px; }
        .choice-btn {
            padding: 15px; background: var(--tbbt-blue); color: white; border: 3px solid black;
            font-weight: bold; cursor: pointer; font-size: 1rem; box-shadow: 3px 3px 0 black;
        }
        .choice-btn:active { transform: translate(1px, 1px); box-shadow: 0 0 0 black; }

        #knock-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); color: white;
            display: none; justify-content: center; align-items: center; font-family: 'Bangers'; font-size: 3rem; z-index: 100; text-align: center;
        }

        .shake { animation: shakeAnim 0.3s ease-in-out; }
        @keyframes shakeAnim { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    </style>
</head>
<body>

<div id="game-container">
    <div class="header-info">
        <div id="day-label">DEN 1 / 120</div>
        <div id="stat-label">SKÓRE: 0</div>
        <div id="mood-label">MOOD: 100%</div>
    </div>

    <div class="story-bar">
        <span id="location-name">NAČÍTÁNÍ...</span>
        <span id="time-of-day">RÁNO</span>
    </div>

    <div id="main-stage">
        <div id="question-panel">
            <h2 id="scenario-text">TBBT: 120 DNÍ V PASADENĚ</h2>
            <div id="choices-box" class="choices-grid">
                <button class="choice-btn" onclick="startGame()">ZAČÍT NOVOU SEZÓNU</button>
                <button id="resume-btn" class="choice-btn" style="background: #27ae60; display: none;" onclick="loadGame()">POKRAČOVAT</button>
            </div>
            <div id="day-story-log" style="display:none;">
                <strong>Dnešní děj:</strong><br>
                <span id="log-content"></span>
            </div>
        </div>
    </div>
</div>

<div id="knock-overlay" onclick="nextDayFlow()">
    <div id="knock-text">DNEŠNÍ DEN SKONČIL...<br><br>*KNOCK KNOCK KNOCK*<br>DALŠÍ DEN</div>
</div>

<script>
    const state = { day: 1, step: 1, score: 0, mood: 100, location: 'livingroom', dayLog: [], currentEpisode: null };

    const config = {
        totalDays: 120,
        rooms: {
            livingroom: { name: "Obývák 4A", colors: ["#e3f2fd", "#bbdefb", "#1565c0"] },
            penny: { name: "Byt Penny", colors: ["#fce4ec", "#f8bbd0", "#ad1457"] },
            office: { name: "Univerzita", colors: ["#e8f5e9", "#c8e6c9", "#2e7d32"] },
            comic: { name: "U Stuarta", colors: ["#fff3e0", "#ffe0b2", "#ef6c00"] },
            cheesecake: { name: "Cheesecake Factory", colors: ["#f9fbe7", "#f0f4c3", "#9e9d24"] }
        },
        ranks: [
            { name: "Barry Kripke", min: -Infinity },
            { name: "Stuart Bloom", min: 1000 },
            { name: "Penny", min: 2500 },
            { name: "Rajesh Koothrappali", min: 4500 },
            { name: "Howard Wolowitz", min: 6500 },
            { name: "Leonard Hofstadter", min: 8500 },
            { name: "Amy Farrah Fowler", min: 10500 },
            { name: "Sheldon Cooper", min: 13000 }
        ]
    };

    // --- DATABÁZE EPIZOD (Každá má 6 kroků) ---
    const episodes = [
        {
            title: "Záhada ukradeného komiksu", loc: "comic",
            steps: [
                { q: "Ráno: Sheldon zjistil, že mu někdo v noci proházel sbírku Flashe.", o1: "Analyzovat otisky prstů lupou.", s1: 10, l1: "Ráno jsme začali detektivním pátráním v archivu." },
                { q: "Dopoledne: Stuart se tváří podezřele a schovává něco pod pultem.", o1: "Vyslechnout Stuarta pomocí FBI metod.", s1: 20, l1: "U Stuarta jsme provedli intenzivní výslech." },
                { q: "Poledne: Wil Wheaton vchází do obchodu a směje se Sheldonovi.", o1: "Vyzvat Wila na souboj v deskovkách.", s1: 30, l1: "V poledne došlo k epickému střetu s Wilem Wheatonem." },
                { q: "Odpoledne: Zjistíte, že komiks si jen půjčil Leonard na čtení.", o1: "Vynadat Leonardovi za porušení protokolu.", s1: 15, l1: "Odpoledne jsme odhalili pravého 'zločince' Leonarda." },
                { q: "Večer: Sheldon musí komiks znovu zařadit do systému.", o1: "Pomoci s katalogizací podle roku vydání.", s1: 20, l1: "Večer se nesl ve znamení přísné reorganizace sbírky." },
                { q: "Noc: Sheldon konečně spokojeně usíná s komiksem v trezoru.", o1: "Zkontrolovat zámek na trezoru 3x.", s1: 10, l1: "Den skončil pocitem bezpečí a řádu." }
            ]
        },
        {
            title: "Pennyina velká role", loc: "penny",
            steps: [
                { q: "Ráno: Penny dostala roli v reklamě na mast proti plísni.", o1: "Pomoci jí naučit se scénář.", s1: 15, l1: "Ráno jsme začali s Penny nacvičovat roli." },
                { q: "Dopoledne: Sheldon kritizuje její vědeckou nepřesnost v textu.", o1: "Přepsat scénář do technické řeči.", s1: 10, l1: "Sheldon se pokusil z reklamy udělat vědeckou studii." },
                { q: "Poledne: Natáčení se odkládá, protože Penny má trému.", o1: "Zazpívat jí 'Soft Kitty' na uklidnění.", s1: 25, l1: "Pennyinu trému jsme zahnali písničkou o koťátku." },
                { q: "Odpoledne: Na scénu přichází režisér, který vypadá jako Kripke.", o1: "Předstírat, že jste její agenti.", s1: 20, l1: "Odpoledne jsme si hráli na agenty z Hollywoodu." },
                { q: "Večer: Penny reklamu natočila, ale Sheldon v ní vidí chyby.", o1: "Oslavit to u vína (Sheldon u vody).", s1: 15, l1: "Večer jsme oslavili úspěch u Penny v bytě." },
                { q: "Noc: Sheldon analyzuje sledovanost reklamy na YouTube.", o1: "Mazat negativní komentáře trollů.", s1: 20, l1: "Noc jsme strávili hlídáním internetové pověsti." }
            ]
        },
        {
            title: "Kripkeho pomsta v laboratoři", loc: "office",
            steps: [
                { q: "Ráno: Kripke napustil Sheldonovu kancelář héliem.", o1: "Mluvit vysokým hlasem a smát se mu.", s1: 20, l1: "Ráno začalo héliovým incidentem v laboratoři." },
                { q: "Dopoledne: Barry Kwipke vyzval Sheldona na souboj v matematice.", o1: "Vyřešit rovnici rychleji než Barry.", s1: 25, l1: "Při matematickém souboji jsme Kripkeho rozdrtili." },
                { q: "Poledne: V menze se Howard snaží sbalit novou kolegyni.", o1: "Upozornit ji na Howardův vztah s matkou.", s1: 15, l1: "Oběd byl plný trapných sociálních interakcí." },
                { q: "Odpoledne: Robotický souboj! Kripkeho robot vypadá silně.", o1: "Hacknout Barryho robota přes Bluetooth.", s1: 30, l1: "Odpoledne jsme ovládli arénu robotických zápasů." },
                { q: "Večer: Sheldon si čistí tabuli od Barryho čmáranic.", o1: "Pomoci mu s dezinfekcí houbičky.", s1: 10, l1: "Večer jsme nastolili hygienu v kanceláři." },
                { q: "Noc: Sheldon plánuje odvetu na zítra.", o1: "Vymyslet past s tekutým dusíkem.", s1: 20, l1: "Den skončil plánováním vědecké pomsty." }
            ]
        }
    ];

    function startGame() {
        Object.assign(state, { day: 1, step: 1, score: 0, mood: 100, dayLog: [] });
        pickEpisode(); render();
    }

    function pickEpisode() {
        state.currentEpisode = episodes[Math.floor(Math.random() * episodes.length)];
        state.location = state.currentEpisode.loc;
        state.dayLog = [];
    }

    function render() {
        const room = config.rooms[state.location];
        const stepData = state.currentEpisode.steps[state.step - 1];
        
        // Barva podle doby dne
        let cIdx = 0; if (state.step > 2) cIdx = 1; if (state.step > 4) cIdx = 2;
        document.body.style.backgroundColor = room.colors[cIdx];

        document.getElementById('day-label').innerText = `DEN ${state.day} / 120`;
        document.getElementById('stat-label').innerText = `SKÓRE: ${state.score}`;
        document.getElementById('mood-label').innerText = `MOOD: ${state.mood}%`;
        document.getElementById('location-name').innerText = room.name.toUpperCase();
        document.getElementById('time-of-day').innerText = ["RÁNO", "DOPOLEDNE", "OBĚD", "ODPOLEDNE", "VEČER", "NOC"][state.step - 1];
        
        document.getElementById('scenario-text').innerText = stepData.q;
        document.getElementById('log-content').innerText = state.dayLog.join(" ");
        document.getElementById('day-story-log').style.display = state.dayLog.length > 0 ? "block" : "none";

        const box = document.getElementById('choices-box');
        box.innerHTML = '';

        const opts = [
            { text: stepData.o1, s: stepData.s1, m: 5, log: stepData.l1 },
            { text: "Udělat to špatně (Bazinga!)", s: 0, m: -20, log: "Tvé rozhodnutí vyvolalo u Sheldona hluboké opovržení." }
        ];

        opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = opt.text;
            btn.onclick = () => {
                state.score += opt.s;
                state.mood = Math.max(0, Math.min(100, state.mood + opt.m));
                state.dayLog.push(opt.log);
                if (opt.m < 0) {
                    document.getElementById('question-panel').classList.add('shake');
                    setTimeout(() => document.getElementById('question-panel').classList.remove('shake'), 400);
                }
                
                state.step++;
                if (state.step > 6) {
                    document.getElementById('knock-overlay').style.display = 'flex';
                } else {
                    render();
                }
                saveGame();
            };
            box.appendChild(btn);
        });
    }

    function nextDayFlow() {
        document.getElementById('knock-overlay').style.display = 'none';
        state.step = 1; state.day++;
        if (state.day > config.totalDays) return finishGame();
        pickEpisode(); render();
    }

    function finishGame() {
        let finalRank = config.ranks[0].name;
        config.ranks.forEach(r => { if (state.score >= r.min) finalRank = r.name; });
        
        document.getElementById('main-stage').innerHTML = `
            <div id="question-panel" style="background:var(--gold)">
                <h1>KONEC 120-DENNÍ SÁGY</h1>
                <p>Prošel jsi všemi peripetiemi pasadenské party.</p>
                <h2>CELKOVÉ SKÓRE: ${state.score}</h2>
                <div style="font-size:2rem; padding:15px; border:5px solid black; margin:20px 0; background:white;">
                    RANK: ${finalRank}
                </div>
                <p>Na stupnici geniality jsi skončil jako <strong>${finalRank}</strong>!</p>
                <button class="choice-btn" onclick="location.reload()">HRÁT ZNOVU</button>
            </div>
        `;
    }

    function saveGame() { localStorage.setItem('tbbt_final_v10', JSON.stringify(state)); }
    function loadGame() { 
        const s = localStorage.getItem('tbbt_final_v10'); 
        if(s) { Object.assign(state, JSON.parse(s)); render(); } 
    }

    window.onload = () => { if(localStorage.getItem('tbbt_final_v10')) document.getElementById('resume-btn').style.display = 'block'; };
</script>
</body>
</html>